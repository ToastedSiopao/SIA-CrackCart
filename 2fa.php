<?php\nsession_start();\n\nif (!isset($_SESSION['2fa_user_id']) || !isset($_SESSION['2fa_code'])) {\n    header(\"Location: login.php\");\n    exit();\n}\n?>\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Two-Factor Authentication</title>\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n    <link href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css\" rel=\"stylesheet\">\n    <link href=\"2fa-styles.css\" rel=\"stylesheet\">\n</head>\n<body>\n    <div class=\"tfa-container\">\n        <div class=\"tfa-header\">\n            <img src=\"assets/Truck.png\" alt=\"Truck Logo\">\n            <h2>2FA Verification</h2>\n            <p>Enter the 6-digit code sent to your email.</p>\n        </div>\n\n        <form id=\"2fa-form\">\n            <div class=\"mb-4\">\n                <input type=\"text\" class=\"form-control\" id=\"code\" name=\"code\" maxlength=\"6\" required autofocus>\n            </div>\n            <button type=\"submit\" class=\"btn btn-primary\">Verify Code</button>\n            <div id=\"error-message\" class=\"text-danger mt-3\"></div>\n        </form>\n    </div>\n\n    <script>\n        document.getElementById('2fa-form').addEventListener('submit', async function(e) {\n            e.preventDefault();\n\n            const code = document.getElementById('code').value;\n            const errorMessage = document.getElementById('error-message');\n\n            if (code.length !== 6 || !/^\d{6}$/.test(code)) {\n                errorMessage.textContent = \"Please enter a valid 6-digit code.\";\n                return;\n            }\n\n            try {\n                const response = await fetch('verify_2fa.php', {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },\n                    body: 'code=' + encodeURIComponent(code)\n                });\n\n                const result = await response.json();\n\n                if (result.success) {\n                    window.location.href = \"dashboard.php\"; \n                } else {\n                    errorMessage.textContent = result.error || \"Invalid code. Please try again.\";\n                }\n            } catch (err) {\n                errorMessage.textContent = \"An unexpected error occurred. Please try again.\";\n            }\n        });\n    </script>\n</body>\n</html>\n